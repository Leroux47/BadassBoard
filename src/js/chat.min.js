const socket=io();let msgID=0;$.ajax({url:"./settings/settings.json",method:"GET",dataType:"json"}).done(e=>{void 0!==e.owmToken&&$(".owmToken__input").val(e.owmToken),void 0!==e.searchEngine?$(".searchEngineSelection__select").val(e.searchEngine.label):($(".searchEngineSelection__select").val(searchEngine.label),socket.emit("customization",searchEngine)),e.RSS?($(".toggleRss__Input").prop("checked",!0),$(".toggleRss__Slider").removeClass("unchecked")):$(".toggleRss__Input").prop("checked",!1)}),socket.on("wallpaper",e=>{const s=()=>{$("<span></span>").addClass("msg reply").text("Sorry, your background image couldn't be loaded... Maybe try another one").appendTo(".msgContainer__msgList__list");$(".backgroundImage").css("backgroundImage","")};$.ajax({url:e,method:"GET",dataType:"",statusCode:{200:()=>{$(".backgroundImage").css("backgroundImage",`url(${e})`)},404:()=>{s()}}}).fail(e=>{"error"===e.statusText&&0===e.readyState&&s()})}),$(".msgContainer__msgList__form").submit(e=>{e.preventDefault(),(new Message).send()}),$(".header__homeIcon").click(()=>{window.open("/")}),$(".header__settingsBtn").click(()=>{showSettings()});socket.on("reply",e=>{e.add=function(){setTimeout(()=>{$("<span></span>").addClass("msg reply").append(e.content).appendTo(".msgContainer__msgList__list")},500)},e.addEmbed=function(){let t=$("<span></span>").addClass("msg reply embed");if(void 0!==e.content.title){let n=$("<div></div>").addClass("embed__fields");if(t.css("border-left",`0.5em solid ${e.content.color}`).append(`<img src="${e.content.icon}" alt="${e.content.title} icon" class="embed__icon"/>`).append(`<a href="${e.content.url}" class="embed__title">${e.content.title}</a>`),void 0!==e.content.fields)for(const[d,i]of e.content.fields.entries()){$("<div></div>").addClass("embed__field").append(i).appendTo(n);d===e.content.fields.length-1&&t.append(n)}t.append(`<article class="embed__desc">${e.content.description}</article>`),void 0!==e.content.img&&t.append(`<img src="${e.content.img}" alt="${e.content.title} picture" class="embed__pic"/>`)}else t.text(e.content);t.appendTo(".msgContainer__msgList__list")},"wiki"!==e.theme&&"movie review"!==e.theme?e.add():e.addEmbed()});const restoreScroll=()=>{$("html, body").css({overflow:"",height:""})},disableScroll=()=>{$("html, body").css({overflow:"hidden",height:"100%"})};const showSettings=()=>{const e=()=>{$(".uploadWarning").length&&$(".uploadWarning").remove(),restoreScroll(),$(".backgroundImage, header, .mainContainer").removeClass("blur"),$(".settings__container").fadeOut()};let a={},o=$(".toggleRss__Input").prop("checked");o?$(".toggleRss__Slider").removeClass("unchecked"):$(".toggleRss__Slider").addClass("unchecked"),$(".header__settingsBtn").click(()=>{$(".backgroundImage, header, .mainContainer").addClass("blur"),disableScroll(),$(".settings__container").fadeIn().css("display","flex")}),$(".backgroundImageUploadForm__Btn").click(()=>{$(".backgroundImageUploadForm__InputFile").click()}),$(".toggleRss__Switch").click(()=>{a.RSS=$(".toggleRss__Input").prop("checked"),$(".toggleRss__Input").prop("checked")?$(".toggleRss__Slider").removeClass("unchecked"):$(".toggleRss__Slider").addClass("unchecked")}),$(".settings__child__cancelBtn").click(()=>{e()}),$(".searchEngineSelection__select").on("change",()=>{let e=$(".searchEngineSelection__select").val();a.searchEngine={},a.searchEngine.label=e,"Bing"===e?a.searchEngine.url=searchEngine.url="https://www.bing.com/search?q=":"DuckDuckGo"===e?a.searchEngine.url=searchEngine.url="https://duckduckgo.com/?q=":"Ecosia"===e?a.searchEngine.url=searchEngine.url="https://www.ecosia.org/search?q=":"Google"===e?a.searchEngine.url=searchEngine.url="https://www.google.com/search?q=test":"Qwant"===e&&(a.searchEngine.url=searchEngine.url="https://www.qwant.com/?q=")}),$(".settings__child__saveBtn").click(()=>{let o=!1;if(""!==$(".backgroundImageUploadForm__InputFile").val()&&""===$(".backgroundImageUploadForm__InputUrl").val()){let e=$(".backgroundImageUploadForm__InputFile").get(0).files[0];if(e.size/1048576>5)o=!0,printError({type:"upload",msg:"Your file is too laaaaarge ! Please select one under 5 Mb."});else{a.backgroundImage=`./upload/${e.name}`;let o=new FormData;o.append("backgroundImageUploadInput",e,e.name),$.ajax({url:"/upload",type:"POST",data:o,processData:!1,contentType:!1,statusCode:{404:()=>{console.log("page not found !")},200:()=>{console.log(`${e.name} was uploaded successfully !`)}},success:e=>{$(".backgroundImage").css("backgroundImage",`url(${a.backgroundImage})`),$("head style").remove(),$("head").append(`<style>.formContainer__container::before {background-image: url(${a.backgroundImage});}</style>`)},error:a=>{printError({type:"generic",msg:"Your new wallpaper failed uploading... Please check the logs for details."}),console.log(o,e,`Error uploading wallpaper :\n${JSON.stringify(a,null,2)}`)}})}}else{if(""===$(".backgroundImageUploadForm__InputFile").val()&&""!==$(".backgroundImageUploadForm__InputUrl").val())if($(".backgroundImageUploadForm__InputUrl").val().match(/^(http|https):\/\/(www.|)[a-zA-Z0-9-\.\/]{1,}\.\w.+/i))if($(".backgroundImageUploadForm__InputUrl").val().length<200)if(a.backgroundImage=$(".backgroundImageUploadForm__InputUrl").val(),$(".backgroundImage").css("backgroundImage",`url(${a.backgroundImage})`),$("head style").length){for(var n=0;n<$("head style").length;n++)$("head style")[n].textContent===headStyle&&$("head style")[n].remove();$("head").append(`<style>.formContainer__container::before {background-image: url(${a.backgroundImage}); !important}</style>`)}else $("head").append(`<style>.formContainer__container::before {background-image: url(${a.backgroundImage}); !important}</style>`);else o=!0,printError({type:"upload",msg:"Your URL is too large ! Please shorten it !"});else o=!0,printError({type:"upload",msg:"Your URL is not supported... Please try another one or open an issue on Github"});else""!==$(".backgroundImageUploadForm__InputFile").val()&&""!==$(".backgroundImageUploadForm__InputUrl").val()&&(o=!0,printError({type:"upload",msg:"Hey, don't be too powerful dude ! One field at a time !"}));$(".toggleRss__Input").prop("checked"),""===$(".backgroundImageUploadForm__InputFile").val()&&""===$(".backgroundImageUploadForm__InputUrl").val()&&""===$(".owmToken__input").val()&&($(".backgroundImage, header, .mainContainer").removeClass("blur"),$(".settings__container").fadeOut()),$(".owmToken__input").val().match(/[a-z0-9]{32}/)&&(a.owmToken=$(".owmToken__input").val(),owmToken=$(".owmToken__input").val())}$(".owmToken__input").val(a.owmToken),o||(e(),socket.emit("customization",a),$(".uploadWarning").length&&$(".uploadWarning").remove(),void 0!==a.RSS&&(!0===a.RSS?location.reload():$(".contentContainers").hide()))})};const Message=function(){this.author="Max",this.content=$(".msgContainer__msgList__form__inputMsg").val(),this.id=msgID,this.dateTime=new Date,this.send=function(){return new Promise((t,s)=>{if(null!==this.content&&""!==this.content){$("<span></span>").addClass("msg flex").text(this.content).appendTo(".msgContainer__msgList__list");socket.emit("chat msg",this),$(".msgContainer__msgList__form__inputMsg").val(""),msgID++,t(this)}else s(this)})}};